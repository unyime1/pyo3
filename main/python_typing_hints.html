<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Appendix D: Python typing hints - PyO3 user guide</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="PyO3 user guide">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="module.html"><strong aria-hidden="true">1.</strong> Python Modules</a></li><li class="chapter-item expanded "><a href="function.html"><strong aria-hidden="true">2.</strong> Python Functions</a></li><li class="chapter-item expanded "><a href="class.html"><strong aria-hidden="true">3.</strong> Python Classes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="class/protocols.html"><strong aria-hidden="true">3.1.</strong> Class customizations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="class/object.html"><strong aria-hidden="true">3.1.1.</strong> Basic object customization</a></li><li class="chapter-item expanded "><a href="class/numeric.html"><strong aria-hidden="true">3.1.2.</strong> Emulating numeric types</a></li><li class="chapter-item expanded "><a href="class/call.html"><strong aria-hidden="true">3.1.3.</strong> Emulating callable objects</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="conversions.html"><strong aria-hidden="true">4.</strong> Type Conversions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="conversions/tables.html"><strong aria-hidden="true">4.1.</strong> Mapping of Rust types to Python types</a></li><li class="chapter-item expanded "><a href="conversions/traits.html"><strong aria-hidden="true">4.2.</strong> Conversion traits</a></li></ol></li><li class="chapter-item expanded "><a href="exception.html"><strong aria-hidden="true">5.</strong> Python Exceptions</a></li><li class="chapter-item expanded "><a href="python_from_rust.html"><strong aria-hidden="true">6.</strong> Calling Python from Rust</a></li><li class="chapter-item expanded "><a href="types.html"><strong aria-hidden="true">7.</strong> GIL, mutability and object types</a></li><li class="chapter-item expanded "><a href="parallelism.html"><strong aria-hidden="true">8.</strong> Parallelism</a></li><li class="chapter-item expanded "><a href="debugging.html"><strong aria-hidden="true">9.</strong> Debugging</a></li><li class="chapter-item expanded "><a href="features.html"><strong aria-hidden="true">10.</strong> Features Reference</a></li><li class="chapter-item expanded "><a href="memory.html"><strong aria-hidden="true">11.</strong> Memory Management</a></li><li class="chapter-item expanded "><a href="advanced.html"><strong aria-hidden="true">12.</strong> Advanced Topics</a></li><li class="chapter-item expanded "><a href="building_and_distribution.html"><strong aria-hidden="true">13.</strong> Building and Distribution</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="building_and_distribution/multiple_python_versions.html"><strong aria-hidden="true">13.1.</strong> Supporting multiple Python versions</a></li></ol></li><li class="chapter-item expanded "><a href="ecosystem.html"><strong aria-hidden="true">14.</strong> Useful Crates</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ecosystem/logging.html"><strong aria-hidden="true">14.1.</strong> Logging</a></li><li class="chapter-item expanded "><a href="ecosystem/async-await.html"><strong aria-hidden="true">14.2.</strong> Async / Await</a></li></ol></li><li class="chapter-item expanded "><a href="faq.html"><strong aria-hidden="true">15.</strong> FAQ &amp; Troubleshooting</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="migration.html">Appendix A: Migration Guide</a></li><li class="chapter-item expanded affix "><a href="rust_cpython.html">Appendix B: PyO3 and rust-cpython</a></li><li class="chapter-item expanded affix "><a href="trait_bounds.html">Appendix C: Trait bounds</a></li><li class="chapter-item expanded affix "><a href="python_typing_hints.html" class="active">Appendix D: Python typing hints</a></li><li class="chapter-item expanded affix "><a href="changelog.html">CHANGELOG</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="contributing.html">Contributing</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">PyO3 user guide</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="typing-and-ide-hints-for-you-python-package"><a class="header" href="#typing-and-ide-hints-for-you-python-package">Typing and IDE hints for you Python package</a></h1>
<p>PyO3 provides an easy to use interface to code native Python libraries in Rust. The accompanying Maturin allows you to build and publish them as a package. Yet, for the better user experience, Python libraries should provide typing hints and documentation for all public entities, so that IDEs can show them during development and type analyzing tools such as <code>mypy</code> can use them to properly verify the code.</p>
<p>Currently the best solution for the problem is to maintain manually the <code>*.pyi</code> files and ship them along with the package.</p>
<h2 id="the-pyi-files-introduction"><a class="header" href="#the-pyi-files-introduction">The <code>pyi</code> files introduction</a></h2>
<p><code>pyi</code> (an abbreviation for <code>Python Interface</code>) is called a <code>Stub File</code> in most of the documentations related to them. Very good definition of what it is can be found in <a href="https://github.com/python/mypy/wiki/Creating-Stubs-For-Python-Modules">old MyPy documentation</a>:</p>
<blockquote>
<p>A stubs file only contains a description of the public interface of the module without any implementations.</p>
</blockquote>
<p>Probably most Python developers encountered them already when trying to use the IDE &quot;Go to Definition&quot; function on any builtin type. For example the definitions of few standard exceptions look like this:</p>
<pre><code class="language-python">class BaseException(object):
    args: Tuple[Any, ...]
    __cause__: BaseException | None
    __context__: BaseException | None
    __suppress_context__: bool
    __traceback__: TracebackType | None
    def __init__(self, *args: object) -&gt; None: ...
    def __str__(self) -&gt; str: ...
    def __repr__(self) -&gt; str: ...
    def with_traceback(self: _TBE, tb: TracebackType | None) -&gt; _TBE: ...

class SystemExit(BaseException):
    code: int

class Exception(BaseException): ...

class StopIteration(Exception):
    value: Any
</code></pre>
<p>As we can see those are not full definitions containing implementation, but just a description of interface. It is usually all that is needed by the user of the library.</p>
<h3 id="what-does-the-peps-say"><a class="header" href="#what-does-the-peps-say">What does the PEPs say?</a></h3>
<p>As of the time of writing this documentation the <code>pyi</code> files are referenced in three PEPs.</p>
<p><a href="https://www.python.org/dev/peps/pep-0008/#function-annotations">PEP8 - Style Guide for Python Code - #Function Annotations</a> (last point) recommends all third party library creators to provide stub files as the source of knowledge about the package for type checker tools.</p>
<blockquote>
<p>(...) it is expected that users of third party library packages may want to run type checkers over those packages. For this purpose <a href="https://www.python.org/dev/peps/pep-0484">PEP 484</a> recommends the use of stub files: .pyi files that are read by the type checker in preference of the corresponding .py files. (...)</p>
</blockquote>
<p><a href="https://www.python.org/dev/peps/pep-0484/#stub-files">PEP484 - Type Hints - #Stub Files</a> defines stub files as follows.</p>
<blockquote>
<p>Stub files are files containing type hints that are only for use by the type checker, not at runtime.</p>
</blockquote>
<p>It contains a specification for them (highly recommended reading, since it contains at least one thing that is not used in normal Python code) and also some general information about where to store the stub files.</p>
<p><a href="https://www.python.org/dev/peps/pep-0561/">PEP561 - Distributing and Packaging Type Information</a> describes in detail how to build packages that will enable type checking. In particular it contains information about how the stub files must be distributed in order for type checkers to use them.</p>
<h2 id="how-to-do-it"><a class="header" href="#how-to-do-it">How to do it?</a></h2>
<p><a href="https://www.python.org/dev/peps/pep-0561/">PEP561</a> recognizes three ways of distributing type information:</p>
<ul>
<li><code>inline</code> - the typing is placed directly in source (<code>py</code>) files;</li>
<li><code>separate package with stub files</code> - the typing is placed in <code>pyi</code> files distributed in their own, separate package;</li>
<li><code>in-package stub files</code> - the typing is placed in <code>pyi</code> files distributed in the same package as source files.</li>
</ul>
<p>The first way is tricky with PyO3 since we do not have <code>py</code> files. When it will be investigated and necessary changes are implemented, this document will be updated.</p>
<p>The second way is easy to do, and the whole work can be fully separated from the main library code. The example repo for the package with stub files can be found in <a href="https://www.python.org/dev/peps/pep-0561/#references">PEP561 references section</a>: <a href="https://github.com/ethanhs/stub-package">Stub package repository</a></p>
<p>The third way is described below.</p>
<h3 id="including-pyi-files-in-your-pyo3maturin-build-package"><a class="header" href="#including-pyi-files-in-your-pyo3maturin-build-package">Including <code>pyi</code> files in your PyO3/Maturin build package</a></h3>
<p>When source files are in the same package as stub files, they should be placed next to each other. We need a way to do that with Maturin. Also, in order to mark our package as typing-enabled we need to add an empty file named <code>py.typed</code> to the package.</p>
<h4 id="if-you-do-not-have-other-python-files"><a class="header" href="#if-you-do-not-have-other-python-files">If you do not have other Python files</a></h4>
<p>If you do not need to add any other Python files apart from <code>pyi</code> to the package, the Maturin provides a way to do most of the work for you. As documented in <a href="https://github.com/PyO3/maturin/blob/084cfaced651b28616aeea1f818bdc933a536bfe/guide/src/project_layout.md#adding-python-type-information">Maturin Guide</a> the only thing you need to do is create a stub file for your module named <code>&lt;module_name&gt;.pyi</code> in your project root and Maturin will do the rest.</p>
<pre><code class="language-text">my-rust-project/
├── Cargo.toml
├── my_project.pyi  # &lt;&lt;&lt; add type stubs for Rust functions in the my_project module here
├── pyproject.toml
└── src
    └── lib.rs
</code></pre>
<p>For example of <code>pyi</code> file see <a href="#my_projectpyi-content"><code>my_project.pyi</code> content</a> section.</p>
<h4 id="if-you-need-other-python-files"><a class="header" href="#if-you-need-other-python-files">If you need other Python files</a></h4>
<p>If you need to add other Python files apart from <code>pyi</code> to the package, you can do it also, but that requires some more work. Maturin provides easy way to add files to package (<a href="https://github.com/PyO3/maturin/blob/0dee40510083c03607834c821eea76964140a126/Readme.md#mixed-rustpython-projects">documentation</a>). You just need to create a folder with the name of your module next to the <code>Cargo.toml</code> file (for customization see documentation linked above).</p>
<p>The folder structure would be:</p>
<pre><code class="language-text">my-project
├── Cargo.toml
├── my_project
│   ├── __init__.py
│   ├── my_project.pyi
│   ├── other_python_file.py
│   └── py.typed
├── pyproject.toml
├── Readme.md
└── src
    └── lib.rs
</code></pre>
<p>Let's go a little bit more into details on the files inside the package folder.</p>
<h5 id="__init__py-content"><a class="header" href="#__init__py-content"><code>__init__.py</code> content</a></h5>
<p>As we now specify our own package content, we have to provide the <code>__init__.py</code> file, so the folder is treated as a package and we can import things from it. We can always use the same content that the Maturin creates for us if we do not specify a python source folder. For PyO3 bindings it would be:</p>
<pre><code class="language-python">from .my_project import *
</code></pre>
<p>That way everything that is exposed by our native module can be imported directly from the package.</p>
<h5 id="pytyped-requirement"><a class="header" href="#pytyped-requirement"><code>py.typed</code> requirement</a></h5>
<p>As stated in <a href="https://www.python.org/dev/peps/pep-0561/">PEP561</a>:</p>
<blockquote>
<p>Package maintainers who wish to support type checking of their code MUST add a marker file named py.typed to their package supporting typing. This marker applies recursively: if a top-level package includes it, all its sub-packages MUST support type checking as well.</p>
</blockquote>
<p>If we do not include that file, some IDEs might still use our <code>pyi</code> files to show hints, but the type checkers might not. MyPy will raise an error in this situation:</p>
<pre><code class="language-text">error: Skipping analyzing &quot;my_project&quot;: found module but no type hints or library stubs
</code></pre>
<p>The file is just a marker file, so it should be empty.</p>
<h5 id="my_projectpyi-content"><a class="header" href="#my_projectpyi-content"><code>my_project.pyi</code> content</a></h5>
<p>Our module stub file. This document does not aim at describing how to write them, since you can find a lot of documentation on it, starting from already quoted <a href="https://www.python.org/dev/peps/pep-0484/#stub-files">PEP484</a>.</p>
<p>The example can look like this:</p>
<pre><code class="language-python">class Car:
    &quot;&quot;&quot;
    A class representing a car.

    :param body_type: the name of body type, e.g. hatchback, sedan
    :param horsepower: power of the engine in horsepower
    &quot;&quot;&quot;
    def __init__(self, body_type: str, horsepower: int) -&gt; None: ...

    @classmethod
    def from_unique_name(cls, name: str) -&gt; 'Car':
        &quot;&quot;&quot;
        Creates a Car based on unique name

        :param name: model name of a car to be created
        :return: a Car instance with default data
        &quot;&quot;&quot;

    def best_color(self) -&gt; str:
        &quot;&quot;&quot;
        Gets the best color for the car.

        :return: the name of the color our great algorithm thinks is the best for this car
        &quot;&quot;&quot;
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="trait_bounds.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="changelog.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="trait_bounds.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="changelog.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
